# Управление процессами

1. Планировщик
1. Процесс
1. Типы процессов
1. Атрибуты процесса
1. Состояния процесса
1. ?? (доработать)
1. Получение базовой информации о процессе (доработать)
1. ps (доработать)
1. Файловая система Proc
1. gdb, strace/ltrace
1. nice, ionice

---


### Планировщик:
- Обеспечивает параллельное выполнение процессов, выделяя процессу ресурс ЦП на некоторое время, измеряемое в квантах (неделимых частях).


### Процесс имеет следующие определения:
1. Программа на стадии выполнения.
1. Объект, которому выделено процессорное время.
1. Асинхронная работа.


### Типы процессов:
1. Системные процессы - являются частью ядра. Всегда расположены в оперативной памяти. Запускаются при инициализации ОС.
1. Демоны (службы) - процессы, выполняемые автономно. Работают в фоновом режиме.
1. Пользовательские процессы - процессы, запущенные пользователем. Создаются и выполняются в рамках пользовательского сеанса.


### Атрибуты процесса:
1. `PID` - идентификатор процесса.  
    - Команда `cat /proc/sys/kernel/pid_max` выведет максимальный __установленный__ PID для процесса.
    - Поменять максимальный __установленный__  PID можно через `echo MAX_PID_NUM >> /proc/sys/kernel/pid_max`.
      Максимальное значение PID - 4 000 000 (4 миллиона).
    - Каждый последующий PID назначается инкрементно к текущему (прибавляя единицу).  
      Когда PID достигает максимального __установленного__ значения выполняется поиск первого свободного PID, начинная перебор с 0.  
      При этом PID 0 используется планировщиком, а PID 1 - init/systemd (эти значения не предустановлены, при этом присваиваются т.к. процессы запускаются первым и вторым). 

1. `PPID` - идентификатор родительского процесса.

1. `UID` - идентификатор владельца. Сообщает от какого пользователя запущен процесс.

1. `EUID` - эффективный идентификатор владельца. Сообщает с правами какого пользователя запущен процесс.

1. `GID` - идентификатор группы. Сообщает основную группу, правами которой наделён процесс. Зависит от основной группы пользователя.

1. `EGID` - эффективный идентификатор группы. Сообщает правами какой группы (или групп) наделён процесс, зависит от групп, в которые включен пользователь.

1. `NI` (Niceness) - "любезность" процесса, от -20 до 19. Чем  выше "любезность", тем меньше процесс посягает на ресурсы.

1. `PRI` (Priority) - от 0 (-20 `NI`) до 39 (19 `NI`) очерёдность, в которой процесс получит ресурс ЦП.

1. `TTY` - управляющий терминал (подключение, в котором запущен процесс).


### Состояния процесса:
1. R (Running) - запущен
1. D (Uninteruptable I/O) - ожидание ввода/вывода
1. t (Trace) - отладка
1. T (STOP) - остановлен (SIGSTOP)
1. S (Sleeping) - не активен
1. Z (Zombie) - процесс-зомби (defunct)


### ??
1. N (Nice) - процесс с низким приоритетом
1. < - процесс с высоким приоритетом
1. s - лидер сессии
1. \+ - в группе foreground
1. WCHAN - адрес события, которое ожидает процесс
1. STIME - время запуска процесса
1. TIME - общее время выполнения процесса
1. SZ - размер образа процесса в памяти (в блоках по 512 байт)


### Получение базовой информации о процессе:
1. ps - report process status
1. top - display Linux process
1. pstree - display a tree of process
1. /proc - виртуальная (специальная) файловая система
1. lsof - list open files
1. fuser - показывает какой процесс держит файл


### ps
-`ef` или `ax` - расширенный вывод обо всех процессах  
`u` - информация о пользователе от которого запущен процесс (включено в -ef)  
`w` - расширить поле cmd (ww - не ограничивать)  
`f` - вывод дерева процессов  
`o` - определить формат вывода  


### proc
1. `cpuinfo` - информация о процессоре
1. `meminfo` - информация о памяти
1. `loadavg` - средняя загрузка
1. `stat` - информация о загрузке системы в машинном коде
1. `N`* (`директории с номерами, сответствуют PID`) -  содержат данные процессов
    1. `limits` - лимиты процесса
    1. `status` - детальная информация о процессе
    1. `environ` - переменные окружения
    1. `exe` - ссылка на исполняемый файл
    1. `stat` - информация о процессе в машинном коде
    1. `maps`, `statm`, `mem` - информация о памяти


### gdb, strace/ltrace
1. `strace COMMAND` - вывод системных вызовов команды COMMAND
    1. `-c` - общая информация о вызовах, их количестве, затраченном времени
    1. `-p PID` - информация по PID
    1. `-t` - отображение информации с привязкой к TIMESTAMP (времени)
    1. `-h` -
1. `ltrace ` - мониторинг вызовов из пространства пользователя к shared библиотекам
    1. `-f` - включая дочерние процессы
    1. `-o FILE` - запись вывода в файл
    1. `-r` - отображение информации с привязкой к TIMESTAMP (времени) 
    1. `-u` - имя пользователя
    1. `-S` - 
1. `gdb` - позволяет менять различные параметры в работе процесса и посылать ему сигналы
    1. `gdb` - запуск
    1. `attach PID` - подсоединение к PID
    1. `call SIG` - отправка сигнала SIG
    1. `detach` - отсоединение
    1. `quit` - выход


### nice, ionice
1. nice - изменяет "любезность" процесса, от -20 до 19. Чем  выше "любезность", тем меньше процесс посягает на ресурсы.

1. ionice - изменяет "приоритет" процесса
    1. Классы приоритетов:
       1. realtime
       1. best-effort
       1. idle
    1. Для классов 2 и 3 есть 8 уровней. Меньше уровень - выше приоритет.

